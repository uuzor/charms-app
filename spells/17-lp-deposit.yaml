version: 8

# V2: Deposit liquidity and receive LP shares
apps:
  $00: t/${app_id}/${app_vk}    # LEAGUE token
  $01: 17/${app_id}/${app_vk}   # LP_SHARE_NFT
  $02: 16/${app_id}/${app_vk}   # LIQUIDITY_POOL_NFT

ins:
  # LP's tokens to deposit
  - utxo_id: ${lp_token_utxo}
    charms:
      $00: ${deposit_amount}

  # Current liquidity pool state
  - utxo_id: ${pool_utxo}
    charms:
      $02:
        pool_id: "${pool_id}"
        total_liquidity: ${current_total_liquidity}
        total_bets_in_play: ${current_bets_in_play}
        total_paid_out: ${current_paid_out}
        total_collected: ${current_collected}
        protocol_revenue: ${current_protocol_revenue}
        house_balance: ${current_house_balance}
        is_active: true
        min_liquidity: ${min_liquidity}
        total_shares: ${current_total_shares}

outs:
  # LP Share NFT to depositor
  - address: ${lp_address}
    charms:
      $01:
        share_id: "${share_id}"
        lp_address: "${lp_address}"
        shares: ${shares_to_mint}  # AMM formula: (deposit * total_shares) / total_liquidity
        initial_deposit: ${deposit_amount}
        total_withdrawn: 0
        deposit_timestamp: ${timestamp}

  # Updated liquidity pool (increased liquidity and shares)
  - address: ${house_address}
    charms:
      $02:
        pool_id: "${pool_id}"
        total_liquidity: ${new_total_liquidity}  # += deposit_amount
        total_bets_in_play: ${current_bets_in_play}
        total_paid_out: ${current_paid_out}
        total_collected: ${current_collected}
        protocol_revenue: ${current_protocol_revenue}
        house_balance: ${new_house_balance}  # += deposit_amount
        is_active: true
        min_liquidity: ${min_liquidity}
        total_shares: ${new_total_shares}  # += shares_to_mint

  # Tokens to house pool
  - address: ${house_address}
    charms:
      $00: ${deposit_amount}
